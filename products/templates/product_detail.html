{% extends 'base.html' %}

{% block content %}
<div class="container mt-5">
  <div class="row">
    <!-- Thumbnails (left side) -->
    <div class="col-md-2 d-flex flex-column align-items-center">
      {% if product.image_url %}
        <img src="{{ product.image_url }}" class="img-thumbnail mb-2 thumb-img" alt="Main" onclick="changeImage(this)">
      {% endif %}
      {% if product.additional_images %}
        {% for img in product.additional_images %}
          <img src="{{ img }}" class="img-thumbnail mb-2 thumb-img" alt="Additional" onclick="changeImage(this)">
        {% endfor %}
      {% endif %}
    </div>

    <!-- Main image and product details -->
    <div class="col-md-6">
      <img id="main-image" src="{{ product.image_url }}" class="img-fluid mb-3 border rounded" style="max-height: 400px;" alt="{{ product.name }}">
    </div>

    <div class="col-md-4">
      <h2>{{ product.name }}</h2>
      <p class="text-muted">{{ product.description }}</p>
      <h4 class="text-success">â‚¦{{ product.price }}</h4>

      <div class="mt-3">
        <a href="{% url 'products:add-to-cart' product.id %}" class="btn btn-primary mb-2 w-100">Add to Cart</a>
        <a href="{% url 'products:buy-now' product.id %}" class="btn btn-success w-100">Buy Now</a>
      </div>
    </div>
  </div>

  <!-- Reviews Section -->
  <hr class="my-5">
  <div class="mt-5">
    <h4>Customer Reviews</h4>
    {% for comment in comments %}
      <div class="border p-3 mb-3 rounded shadow-sm">
        <strong>{{ comment.name }}</strong>
        <p class="mb-1">Rating: {{ comment.rating }}/5</p>
        <p>{{ comment.text }}</p>
        <small class="text-muted">{{ comment.created_at|date:"M d, Y" }}</small>
      </div>
    {% empty %}
      <p>No reviews yet.</p>
    {% endfor %}

    <form method="post" class="mt-4 p-4 border rounded bg-light shadow-sm">
      {% csrf_token %}
      <div class="form-group mb-3">
        <label for="name">Your Name</label>
        <input type="text" name="name" class="form-control" required>
      </div>

      <div class="form-group mb-3">
        <label for="text">Your Review</label>
        <textarea name="text" class="form-control" rows="3" required></textarea>
      </div>

      <div class="form-group mb-3">
        <label for="rating">Rating</label>
        <select name="rating" class="form-control" required>
          <option value="">Select rating</option>
          {% for i in "12345" %}
            <option value="{{ i }}">{{ i }}</option>
          {% endfor %}
        </select>
      </div>

      <button type="submit" class="btn btn-outline-primary w-100">Submit Review</button>
    </form>
  </div>
</div>

<!-- JS to update the main image on click -->
<script>
  function changeImage(thumb) {
    const main = document.getElementById('main-image');
    main.src = thumb.src;
  }
</script>
{% endblock %}